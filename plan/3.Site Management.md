# Phase 2: Integration Hub Module
## Unified Third-Party Service Connection Management

**Module ID:** PHASE-2-INTEGRATION  
**Priority:** P1 (Enables Automation)  
**Estimated Duration:** 3-4 Weeks  
**Team Size:** 2 Backend Engineers  
**Status:** Ready for Implementation  
**Dependencies:** Module 1 (Auth & Encryption), Module 2 (Server Connections - optional)

---

## ğŸ¯ IMPLEMENTATION DECISIONS (Feb 8, 2026)

**P0 Integrations (Phase 1):** WHM + SMTP only  
**P1 Integrations (Deferred):** Git, Slack, Discord  
**SMS Provider:** AWS SNS / Generic webhook  
**Encryption:** libsodium-wrappers for API keys  
**Testing:** Mock all external APIs, >80% coverage

---

## Executive Summary

The Integration Hub provides a centralized, secure connection layer for all third-party services and APIs. While Module 2 handles raw server (SSH) access, this module handles service (API) access, abstracting authentication, rate limiting, and client instantiation for hosting panels, billing systems, version control, and automation tools.

### Business Value
- **Unified Integration:** Single source of truth for all external service credentials
- **Developer Productivity:** Standardized client factory eliminates integration complexity
- **Security & Compliance:** Encrypted credential storage, comprehensive audit logging
- **Operational Efficiency:** Connection testing, health monitoring, automatic retry logic

### Technical Highlights
- Provider adapter pattern for extensibility
- Encrypted credential storage using Module 1 encryption service
- Client factory pattern for standardized API access
- Universal webhook receiver for event ingestion
- Connection testing per provider type
- Rate limiting and circuit breaker patterns

---

## Supported Integration Types

### Phase 1 Integrations
1. **Hosting Panels**
   - WHM (WebHost Manager) - API Token
   - cPanel - API Token or Username/Password
   - Plesk - API Key

2. **Billing & CRM**
   - WHMCS - API Identifier + Secret
   - vTiger CRM - Access Key + Username

3. **Automation & Configuration**
   - Ansible Tower/AWX - Bearer Token
   - Terraform Cloud - API Token (future)

4. **Version Control**
   - GitHub - Personal Access Token (PAT)
   - GitLab - Personal Access Token (PAT)
   - Bitbucket - App Password (future)

5. **Communication**
   - Slack - Webhook URL
   - Discord - Webhook URL
   - Microsoft Teams - Webhook URL (future)

---

## Implementation Roadmap

### Sprint 1: Core Infrastructure (Week 1)
**Goal:** Database schema, encryption, and basic CRUD operations

#### Backend Tasks
1. **Database Schema & Migrations**
   - [ ] Design Integration model with provider types
   - [ ] Create Prisma schema with encrypted config field
   - [ ] Implement database migrations
   - [ ] Add indexes for performance
   - [ ] Create seed data for testing

2. **Integration Service Foundation**
   - [ ] Create IntegrationService with DI
   - [ ] Implement CRUD operations
   - [ ] Build validation logic per provider
   - [ ] Integrate with Module 1 encryption service
   - [ ] Implement error handling

3. **Provider Registry**
   - [ ] Create provider type enum
   - [ ] Define provider configuration schemas
   - [ ] Build provider validation logic
   - [ ] Implement provider metadata storage

#### Testing & Documentation
- [ ] Unit tests for CRUD operations
- [ ] Unit tests for encryption integration
- [ ] Database migration testing
- [ ] API documentation setup

**Deliverables:**
- âœ… Working database schema
- âœ… Basic CRUD operations
- âœ… Encrypted credential storage
- âœ… Provider registry

---

### Sprint 2: Provider Adapters (Week 2)
**Goal:** Implement adapter pattern and core provider integrations

#### Backend Tasks
1. **Adapter Pattern Implementation**
   - [ ] Create IntegrationAdapter interface
   - [ ] Define standard methods (testConnection, getClient)
   - [ ] Build base adapter class
   - [ ] Implement error handling framework
   - [ ] Create adapter factory

2. **WHM Adapter**
   - [ ] Implement WHM API client wrapper
   - [ ] Create authentication logic (API Token)
   - [ ] Build testConnection method (call applist)
   - [ ] Implement common operations (listAccounts, getAccountInfo)
   - [ ] Add error handling and retry logic

3. **WHMCS Adapter**
   - [ ] Implement WHMCS API client wrapper
   - [ ] Create authentication logic (Identifier + Secret)
   - [ ] Build testConnection method (GetStats)
   - [ ] Implement common operations (GetClients, GetProducts)
   - [ ] Add error handling and retry logic

4. **Git Adapter (GitHub/GitLab)**
   - [ ] Implement Git API client wrapper
   - [ ] Create authentication logic (PAT)
   - [ ] Build testConnection method (list repos)
   - [ ] Implement common operations (clone, pull, commit)
   - [ ] Add error handling and retry logic

#### Testing & Documentation
- [ ] Unit tests for each adapter
- [ ] Integration tests with mock APIs
- [ ] Connection testing validation
- [ ] Adapter documentation

**Deliverables:**
- âœ… Adapter pattern framework
- âœ… WHM adapter operational
- âœ… WHMCS adapter operational
- âœ… Git adapter operational

---

### Sprint 3: Client Factory & API (Week 3)
**Goal:** Standardized client access and REST API

#### Backend Tasks
1. **Client Factory Service**
   - [ ] Create ClientFactory service
   - [ ] Implement getClient<T>(integrationId, type) method
   - [ ] Build credential decryption logic
   - [ ] Implement client caching (Redis)
   - [ ] Add connection pooling
   - [ ] Create client lifecycle management

2. **REST API Endpoints**
   - [ ] POST /integrations - Create integration
   - [ ] GET /integrations - List integrations
   - [ ] GET /integrations/:id - Get integration details
   - [ ] PATCH /integrations/:id - Update integration
   - [ ] DELETE /integrations/:id - Delete integration
   - [ ] POST /integrations/:id/test - Test connection
   - [ ] GET /integrations/providers - List supported providers

3. **RBAC Integration**
   - [ ] Implement permission guards
   - [ ] Create role-based filtering
   - [ ] Build audit logging
   - [ ] Add rate limiting

4. **Health Monitoring**
   - [ ] Implement health check service
   - [ ] Create periodic connection testing
   - [ ] Build status tracking
   - [ ] Implement alerting on failures

#### Testing & Documentation
- [ ] API endpoint testing
- [ ] Client factory testing
- [ ] RBAC enforcement testing
- [ ] Complete Swagger documentation

**Deliverables:**
- âœ… Client factory operational
- âœ… Complete REST API
- âœ… RBAC enforcement
- âœ… Health monitoring

---

### Sprint 4: Webhook Gateway & Polish (Week 4)
**Goal:** Universal webhook receiver and production readiness

#### Backend Tasks
1. **Webhook Gateway**
   - [ ] Create universal webhook endpoint
   - [ ] Implement signature verification per provider
   - [ ] Build event normalization
   - [ ] Create event dispatching to Module 7 (Event Store)
   - [ ] Implement webhook retry logic
   - [ ] Add webhook audit logging

2. **Additional Adapters**
   - [ ] Implement Slack adapter
   - [ ] Implement Discord adapter
   - [ ] Implement Ansible adapter
   - [ ] Create adapter documentation

3. **Performance Optimization**
   - [ ] Implement connection pooling
   - [ ] Add Redis caching for clients
   - [ ] Optimize database queries
   - [ ] Implement batch operations

4. **Security Hardening**
   - [ ] Conduct security audit
   - [ ] Implement rate limiting per integration
   - [ ] Add input sanitization
   - [ ] Create webhook signature validation
   - [ ] Implement IP allowlisting (optional)

#### Frontend Tasks
1. **Integration Management UI**
   - [ ] Create integration list page
   - [ ] Build integration form (multi-step)
   - [ ] Implement provider-specific fields
   - [ ] Create test connection UI
   - [ ] Build integration detail page

#### Testing & Documentation
- [ ] Webhook testing with mock payloads
- [ ] Load testing
- [ ] Security testing
- [ ] Complete user documentation

**Deliverables:**
- âœ… Webhook gateway operational
- âœ… All Phase 1 adapters complete
- âœ… Integration management UI
- âœ… Production-ready system

---

## Technical Architecture

### System Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  External Services                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   WHM    â”‚  â”‚  WHMCS   â”‚  â”‚  GitHub  â”‚  â”‚ Slack  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼ API Calls / Webhooks
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Integration Hub                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Client Factory Service                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  WHM   â”‚  â”‚ WHMCS  â”‚  â”‚  Git   â”‚  â”‚ Slack  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚Adapter â”‚  â”‚Adapter â”‚  â”‚Adapter â”‚  â”‚Adapter â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Webhook Gateway                           â”‚  â”‚
â”‚  â”‚  - Signature Verification                         â”‚  â”‚
â”‚  â”‚  - Event Normalization                            â”‚  â”‚
â”‚  â”‚  - Event Dispatching                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Data Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚    Redis     â”‚  â”‚  Event Store â”‚ â”‚
â”‚  â”‚(Integrations)â”‚  â”‚   (Cache)    â”‚  â”‚  (Module 7)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Adapter Pattern
```typescript
// Base Interface
interface IntegrationAdapter {
  testConnection(): Promise<ConnectionTestResult>;
  getClient(): Promise<any>;
  normalizeError(error: any): IntegrationError;
}

// WHM Adapter Implementation
class WhmAdapter implements IntegrationAdapter {
  constructor(private config: WhmConfig) {}
  
  async testConnection(): Promise<ConnectionTestResult> {
    try {
      const response = await axios.get(
        `${this.config.baseUrl}/json-api/applist`,
        {
          headers: {
            Authorization: `whm root:${this.config.apiToken}`
          }
        }
      );
      return {
        success: true,
        message: 'WHM connection successful',
        latency: response.duration
      };
    } catch (error) {
      return {
        success: false,
        message: this.normalizeError(error).message
      };
    }
  }
  
  async getClient(): Promise<WhmClient> {
    return new WhmClient(this.config);
  }
}
```

### Database Schema
```prisma
model Integration {
  id              String       @id @default(uuid())
  name            String
  provider        ProviderType
  
  // Connection Config
  baseUrl         String
  username        String?
  
  // Security (encrypted)
  encryptedConfig String       @db.Text
  
  // Operational
  isActive        Boolean      @default(true)
  lastSyncAt      DateTime?
  healthStatus    HealthStatus @default(UNKNOWN)
  lastError       String?
  
  // Relations
  linkedServerId  String?
  linkedServer    Server?      @relation(fields: [linkedServerId], references: [id])
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  
  @@index([provider])
  @@index([isActive])
  @@index([healthStatus])
  @@map("integrations")
}

enum ProviderType {
  WHM
  CPANEL
  WHMCS
  ANSIBLE
  GIT_GITHUB
  GIT_GITLAB
  CRM_VTIGER
  SLACK
  DISCORD
}

enum HealthStatus {
  UNKNOWN
  HEALTHY
  DEGRADED
  DOWN
}
```

---

## API Specification

### Endpoints

#### POST /api/v1/integrations
Create new integration

**Request Body:**
```json
{
  "name": "Production WHM",
  "provider": "WHM",
  "baseUrl": "https://server1.host.com:2087",
  "credentials": {
    "apiToken": "your-whm-api-token"
  },
  "linkedServerId": "srv_abc123"
}
```

**Response:** 201 Created
```json
{
  "id": "int_xyz789",
  "name": "Production WHM",
  "provider": "WHM",
  "baseUrl": "https://server1.host.com:2087",
  "healthStatus": "UNKNOWN",
  "createdAt": "2026-02-07T10:00:00Z"
}
```

#### POST /api/v1/integrations/:id/test
Test integration connection

**Response:** 200 OK
```json
{
  "success": true,
  "message": "WHM connection successful",
  "latency": 145,
  "testedAt": "2026-02-07T10:05:00Z",
  "details": {
    "apiVersion": "v1",
    "serverVersion": "11.110.0.5"
  }
}
```

#### POST /api/v1/integrations/hooks/:integrationId
Universal webhook receiver

**Request Body:** (Provider-specific)
```json
{
  "event": "push",
  "repository": "owner/repo",
  "commits": [...]
}
```

**Response:** 200 OK
```json
{
  "received": true,
  "eventId": "evt_abc123"
}
```

---

## Provider-Specific Implementation

### WHM Adapter
**Authentication:** API Token in Authorization header  
**Test Method:** Call `/json-api/applist`  
**Common Operations:**
- List cPanel accounts
- Create cPanel account
- Suspend/Unsuspend account
- Get account disk usage

### WHMCS Adapter
**Authentication:** Identifier + Secret in request body  
**Test Method:** Call `GetStats` API  
**Common Operations:**
- Get client details
- Get product list
- Create ticket
- Get invoice status

### GitHub Adapter
**Authentication:** Personal Access Token in Authorization header  
**Test Method:** Call `/user/repos`  
**Common Operations:**
- List repositories
- Clone repository
- Get commit history
- Create webhook

---

## Security Considerations

### Credential Protection
1. **Encryption at Rest**
   - All credentials encrypted using Module 1 encryption service
   - Separate encryption key from database
   - Key rotation supported

2. **Access Control**
   - RBAC enforced on all endpoints
   - Credentials never returned in API responses
   - Audit logging for all credential access

### Webhook Security
1. **Signature Verification**
   - GitHub: HMAC SHA256 signature
   - GitLab: Secret token
   - Slack: Signing secret
   - WHMCS: Secret key

2. **IP Allowlisting** (Optional)
   - Configure allowed IP ranges per provider
   - Reject requests from unknown IPs

---

## Success Metrics

### Functional Metrics
- âœ… Support 5+ integration types
- âœ… Connection test success rate >98%
- âœ… Zero credential leaks
- âœ… 100% audit coverage

### Performance Metrics
- âœ… API response time <200ms
- âœ… Connection test <10s
- âœ… Webhook processing <100ms
- âœ… Client factory cache hit rate >80%

---

## Documentation Deliverables

### Technical Documentation
- [ ] Architecture diagrams
- [ ] Adapter implementation guide
- [ ] API documentation (Swagger)
- [ ] Webhook integration guide

### User Documentation
- [ ] Integration setup guide per provider
- [ ] Troubleshooting guide
- [ ] Best practices guide

---

## Appendix: Original Requirements

[Original requirements preserved below for reference]

---

2. Detailed Functional Requirements
2.1 Integration Profile Management
FR-INT-001: Integration Registry
Description: Define and store connection details for external services. Actors: SUPER_ADMIN Inputs:

name: Friendly name (e.g., "Main Hosting Cluster WHM").

provider: Enum (WHMCS, WHM, C_PANEL, ANSIBLE, GIT, V_TIGER).

baseUrl: The API endpoint (e.g., https://server1.host.com:2087).

credentials: JSON blob (structure varies by provider).

linkedServerId: (Optional) If this integration is hosted on a specific server from Module 2 (e.g., a local WHM instance).

Process:

Validate baseUrl format.

Encrypt sensitive fields in credentials (e.g., api_token, password) using Module 1.

Store record.

Auto-Test: Trigger FR-INT-002 immediately to verify.

FR-INT-002: Connection Testing (The Handshake)
Description: Verify the credentials work without performing destructive actions. Logic by Provider:

WHMCS: Call GetStats or GetClients (limit 1).

WHM: Call applist or gethostname.

Ansible: Ping the controller.

Git: List repositories for the user.

vTiger: Login/Challenge check. Output:

Success: Updates lastConnectedAt timestamp.

Failure: Returns precise API error (e.g., "403 Forbidden - Access Denied").

2.2 The Client Factory (Developer Experience)
This is the most critical backend feature for your future automation agents.

FR-INT-003: Standardized Client Request
Description: Other modules (like the future "WP-AutoHealer" sub-module) request a working client from here. Interface: IntegrationsService.getClient<T>(integrationId, type) Process:

Fetch Integration record.

Decrypt credentials.

Instantiate the specific SDK/Adapter (e.g., axios instance with correct headers for WHM).

Return the ready-to-use client.

2.3 Webhook Gateway (Ingress)
FR-INT-004: Universal Webhook Receiver
Description: A single entry point for external services to notify your system of events (e.g., "Git Push", "WHMCS Ticket Created"). Endpoint: POST /api/v1/integrations/hooks/:integrationId Process:

Verify integrationId exists and is active.

Signature Verification: Validate the payload (e.g., GitHub SHA256 signature, WHMCS secret).

Event Normalization: Convert provider-specific JSON into a standard system Event (e.g., EVENT_CODE_PUSH, EVENT_TICKET_NEW).

Dispatch: Send to the Event Bus (Module 5: Logging/Event Store) for processing.

3. Data Models (Prisma)
3.1 Integration
TypeScript
model Integration {
  id              String   @id @default(uuid())
  name            String
  provider        ProviderType // WHM, WHMCS, GIT, ANSIBLE, CRM
  
  // -- Connection Config --
  baseUrl         String
  username        String?  // Non-sensitive user identifier
  
  // -- Security --
  encryptedConfig String   // Stores JSON: { apiKey, apiSecret, password } encrypted
  
  // -- Operational --
  isActive        Boolean  @default(true)
  lastSyncAt      DateTime?
  healthStatus    HealthStatus @default(UNKNOWN)
  lastError       String?
  
  // -- Relations --
  linkedServerId  String?  // Optional link to Module 2
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

enum ProviderType {
  WHM
  WHMCS
  ANSIBLE
  GIT_GITHUB
  GIT_GITLAB
  CRM_VTIGER
  SLACK
}
4. Specific Integration Logic (The "Adapters")
4.1 WHMCS Adapter
Auth Method: Identifier + Secret (Header Authorization: Basic ...).

Capabilities: Check Client Status, Get Product Details, Create Ticket.

4.2 WHM (WebHost Manager) Adapter
Auth Method: WHM API Token (Header Authorization: whm root:TOKEN).

Capabilities: Create cPanel Account, Suspend Account, List Accounts, AutoSSL Run.

Relevance: This is the parent of "WP-AutoHealer" sites that are hosted on cPanel.

4.3 Ansible Adapter
Auth Method: Bearer Token.

Capabilities: Trigger Job Template (e.g., "Patch Server", "Deploy App").

4.4 Git Adapter (GitHub/GitLab)
Auth Method: Personal Access Token (PAT).

Capabilities: Clone Repo, Pull Updates, Check Commit History.

5. API Specification
Endpoints
GET /api/v1/integrations - List all configured integrations.

POST /api/v1/integrations - Add new integration (Encryption happens here).


POST /api/v1/integrations/:id/test - Trigger connectivity test.

DELETE /api/v1/integrations/:id - Remove integration.

GET /api/v1/integrations/providers - List supported providers (for UI dropdowns).

6. Implementation Plan for AI Agent
Phase 1: The Core Service

Create Integration model in Prisma.

Implement IntegrationService with CRUD and Encryption (reusing Module 1's EncryptionService).

Phase 2: The Adapters

Create an interface IntegrationAdapter with a method testConnection().

Implement WhmAdapter using axios.

Implement WhmcsAdapter using axios.

Implement GitAdapter using simple-git or GitHub API.

Phase 3: The API

Expose the CRUD endpoints.

Implement the "Test Connection" button logic in the frontend.

Phase 4: Webhooks (Future Proofing)

Set up the /hooks/:id route to log incoming payloads (even if we don't process them yet).

Acceptance Criteria:

[ ] Admin can add a WHM integration by providing URL and API Token.

[ ] Clicking "Test Connection" successfully pings the remote API and returns "Success".

[ ] API Tokens are stored encrypted in the DB.

[ ] Admin can add a Git integration (GitHub) and test connection.
